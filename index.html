<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <title>WELCOME TO WASM CALCULATOR!</title>
    <script wasm="./kotlin/build/compute-kt.wasm" src="./kotlin/build/compute-kt.wasm.js"></script>
    <script src="./cpp/build/compute-cpp.js"></script>
    <script type="module">
        import {decryptAs} from "./assemblyscript/build/release.js";
        import {decryptKt} from "./kotlin/compute.js";
        import {decryptCs} from "./dotnet/build/compute.js";

        const inputCount = 1
        let data = []

        const buildCharDiv = (numberArray) => {
            console.log(numberArray)
            const charArray = numberArray.map(it => String.fromCharCode(+it))

            const div = document.createElement("div")
            charArray.forEach(it => {
                const resDiv = document.createElement("div")
                resDiv.className = "res-div"
                resDiv.innerHTML = it

                div.appendChild(resDiv)
            })

            return div
        }

        const readData = () => {
            data = Array.from(document.getElementsByClassName("magic-input")).map(it => it.value)

            document.getElementById("plain").innerHTML = ""
            document.getElementById("plain").appendChild(buildCharDiv(data))
        }

        const inputContainer = document.getElementById("inputs")
        for (let i = 0; i < inputCount; i++) {
            const input = document.createElement("input")
            input.setAttribute("type", "text")
            input.className = "magic-input"

            input.addEventListener("blur", readData)

            inputContainer.appendChild(input)
        }

        const asDecrypter = document.getElementById("as-decrypter")
        const cppDecrypter = document.getElementById("cpp-decrypter")
        const ktDecrypter = document.getElementById("kt-decrypter")
        const csDecrypter = document.getElementById("cs-decrypter")

        const applyDecrypt = async (el, fn, resultId) => {
            el.setAttribute("disabled", "disabled")
            data = await Promise.all(data.map(fn))
            document.getElementById(resultId).innerHTML = ""
            document.getElementById(resultId).appendChild(buildCharDiv(data))
        }

        asDecrypter.addEventListener("click", () => applyDecrypt(asDecrypter, decryptAs, "as-result"))
        cppDecrypter.addEventListener("click", () => applyDecrypt(cppDecrypter, Module._decryptCpp, "cpp-result"))
        ktDecrypter.addEventListener("click", () => applyDecrypt(ktDecrypter, async it => await decryptKt(it, 5), "kt-result"))
        csDecrypter.addEventListener("click", () => applyDecrypt(csDecrypter, it => decryptCs(it, 3), "cs-result"))
    </script>

    <style>
        .magic-input, .res-div {
            width: 80px;
            font-size: 30px;
            margin-right: 10px;
            display: inline-block;
            text-align: center;
        }

        .res-div {
            font-size: 20px;
            border: 1px solid #666;
            border-radius: 5px;
            height: 2em;
            background: lightgoldenrodyellow;
        }

        #cs-result div{
            background: red;
            color: white;
            font-weight: bold;
        }

        #plain, #inputs {
            display: block;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="">
        <h1>WELCOME TO THE MAGIC WASM DECRYPTER!</h1>
    </div>
    <div class=" py-2">
        <div id="inputs"></div>
    </div>
    <div class=" py-2">
        <div id="plain"></div>
    </div>
    <div class=" py-2">
        <button class="btn btn-primary" id="as-decrypter">Apply <img
                src="https://upload.wikimedia.org/wikipedia/commons/0/00/AssemblyScript_logo_2020.svg"
                height="20"/> Decrypter!
        </button>
        <div id="as-result" style="margin-top: 10px"></div>
    </div>
    <div class=" py-2">
        <button class="btn btn-primary" id="cpp-decrypter">Apply
            <img
                    src="https://upload.wikimedia.org/wikipedia/commons/1/18/ISO_C%2B%2B_Logo.svg"
                    height="20"/> Decrypter!
        </button>
        <div id="cpp-result" style="margin-top: 10px"></div>
    </div>
    <div class=" py-2">
        <button class="btn btn-primary" id="kt-decrypter">Apply
            <img
                    src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/06/Kotlin_Icon.svg/1024px-Kotlin_Icon.svg.png?20171012085709"
                    height="20"/> Decrypter!
        </button>
        <div id="kt-result" style="margin-top: 10px"></div>
    </div>
    <div class=" py-2">
        <button class="btn btn-primary" id="cs-decrypter">Apply
            <img
                    src="https://upload.wikimedia.org/wikipedia/commons/0/0e/Microsoft_.NET_logo.png?20200524033331"
                    height="20"/> Decrypter!
        </button>
        <div id="cs-result" style="margin-top: 10px"></div>
    </div>
</div>


</body>
</html>
